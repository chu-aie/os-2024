# 스케줄링: 비례 배분)[^sadey7645][^Gyu-BBB]

[^sadey7645]: [김진우](https://github.com/sadey7645)
[^Gyu-BBB]: [이규범](https://github.com/Gyu-BBB)

비례 배분(Proportional Share) 스케줄링은 기존의 스케줄링 알고리즘과는 다른 목적을 가지고 있습니다. 이전의 알고리즘들이 반환 시간(turnaround time)이나 응답 시간(response time)을 최적화하는 데 중점을 뒀다면, 비례 배분 스케줄링은 각 작업(job)이나 프로세스에게 CPU 시간의 일정 비율을 보장하는 것을 목표로 합니다.

비례 배분 스케줄링의 대표적인 예시로는 Waldspurger와 Weihl이 제안한 '추첨 스케줄링(Lottery Scheduling)'이 있습니다. 이 아이디어 자체는 상당히 오래되었는데, 그 기본 개념은 매우 간단합니다. 다음에 실행할 프로세스를 추첨을 통해 랜덤하게 선택하되, CPU 시간을 더 많이 할당받아야 할 프로세스에게는 추첨에 당첨될 기회를 더 많이 준다는 것이죠.

예를 들어, 두 개의 프로세스 A와 B가 시스템에 존재하고 A는 CPU 시간의 80%를, B는 20%를 받기로 했다고 가정해 봅시다. 추첨 스케줄링에서는 전체 추첨권(ticket) 100장 중 A에게 80장을, B에게 20장을 부여할 것입니다. 그리고 매 스케줄링 시점마다 이 추첨권 중 하나를 무작위로 뽑아, 뽑힌 추첨권을 가진 프로세스를 다음에 실행합니다. 이렇게 하면 장기적으로 봤을 때 A와 B가 각각 CPU 시간의 80%, 20%를 할당받을 수 있게 되는 거죠.

```{admonition} 핵심 질문: CPU를 정해진 비율로 나누는 방법은?
특정한 비율로 CPU 시간을 분배하도록 스케줄러를 어떻게 설계할 수 있을까요? 이를 위해 필요한 핵심 기술은 무엇이고, 그 기술은 얼마나 효과적일까요?
```

비례 배분 스케줄링의 핵심은 각 프로세스에게 할당된 '점유율(share)'을 어떻게 구현하느냐에 있습니다. 앞서 본 추첨 스케줄링은 각 프로세스의 점유율을 추첨권 수로 표현한 것인데, 실제 구현에서는 좀 더 다양한 방법이 사용될 수 있습니다. 예를 들어 각 프로세스에 우선순위 값을 부여하고, 그 값에 비례하는 시간 동안 CPU를 할당하는 방식 등이 있겠죠.

중요한 점은 비례 배분 스케줄링이 기존의 스케줄링 알고리즘과는 다른 관점에서 공정성(fairness)을 추구한다는 것입니다. 이는 응답 시간이나 반환 시간 같은 성능 지표와는 무관하게, 시스템 자원을 사용자나 관리자가 지정한 비율에 따라 엄격히 배분하는 데 주안점을 둡니다. 물론 실제 적용에 있어서는 여러 가지 trade-off가 존재하겠지만, 비례 배분은 스케줄링 문제에 대한 또 하나의 흥미로운 접근 방식임에는 틀림없어 보입니다.

## 기본 개념 : 추첨권이 당신의 몫을 나타낸다

비례 배분 스케줄링에서 가장 중요한 개념은 바로 '추첨권(ticket)'입니다. 추첨권은 각 프로세스가 시스템 자원, 특히 CPU 시간을 얼마나 할당받을 것인지를 결정하는 일종의 '화폐'와 같은 역할을 합니다.

### 개념 설명

시스템 내의 모든 프로세스는 일정 수의 추첨권을 받습니다. 이때 각 프로세스에 할당되는 추첨권의 수는 해당 프로세스의 상대적 중요도나 우선순위를 반영합니다.

프로세스의 중요도가 높을수록, 또는 더 많은 CPU 시간을 할당받아야 할수록 더 많은 추첨권을 받게 되는 거죠. 예를 들어 프로세스 A가 80장의 추첨권을, 프로세스 B가 20장의 추첨권을 받았다면, 이는 A가 B에 비해 4배 더 많은 CPU 시간을 할당받아야 함을 의미합니다.

스케줄러는 매 스케줄링 시점마다 전체 추첨권 중 하나를 무작위로 선택하고, 뽑힌 추첨권을 가진 프로세스에게 CPU를 할당합니다. 따라서 각 프로세스가 실제로 받는 CPU 시간의 양은 전체 추첨권 중 자신이 가진 추첨권의 비율에 비례하게 되는 것입니다.

### 특징

- 공평성(Fairness): 비례 배분 스케줄링은 각 프로세스가 자신의 추첨권 비율만큼 공정하게 CPU 시간을 받을 수 있도록 보장합니다. 이는 특정 프로세스가 CPU를 독점하는 것을 방지하고, 모든 프로세스가 자신의 몫만큼은 확실히 받을 수 있도록 합니다.

- 유연성(Flexibility): 프로세스의 추첨권 수를 조정함으로써 우선순위를 쉽게 변경할 수 있습니다. 새로운 프로세스가 추가되더라도 추첨권을 적절히 배분하면 되므로 시스템 변화에 유연하게 대응할 수 있습니다. 또한 시스템의 요구사항이 바뀌었을 때 추첨권의 분배 비율을 조정함으로써 자원 할당을 쉽게 튜닝할 수 있습니다.

- 상대적 중요도의 표현: 각 프로세스에게 할당된 추첨권의 수는 해당 프로세스의 상대적인 중요도를 나타냅니다. 추첨권이 많을수록 더 자주 추첨에서 선택되므로, 결과적으로 더 많은 CPU 시간을 할당받게 됩니다. 이렇게 추첨권의 비율을 통해 프로세스 간의 상대적 우선순위를 간단하고 직관적으로 표현할 수 있습니다.

이처럼 추첨권의 개념을 도입함으로써 비례 배분 스케줄링은 사용자나 관리자가 지정한 비율에 따라 시스템 자원을 공정하고 유연하게 분배할 수 있게 됩니다. 물론 실제 구현에서는 추첨 과정을 어떻게 효율적으로 수행할 것인지, 프로세스의 동적인 생성과 종료를 어떻게 처리할 것인지 등 고려해야 할 사항이 많지만, 추첨권을 통한 자원 할당이라는 기본 아이디어 자체는 매우 흥미롭고 유용해 보입니다.

## 추첨 기법

비례 배분 스케줄링에서는 각 프로세스에게 할당된 추첨권(ticket)의 수에 비례하여 CPU 시간을 배분합니다. 이를 위해 '추첨(lottery)' 방식이 사용되는데, 그 동작 과정은 다음과 같습니다.

1. 티켓 분배: 각 프로세스의 상대적 중요도에 따라 추첨권이 할당됩니다. 중요도가 높은 프로세스일수록 더 많은 추첨권을 받습니다.

2. 총 티켓 수 계산: 스케줄러는 시스템 내 모든 프로세스가 보유한 추첨권의 총합을 계산합니다. 이는 추첨 과정에서 선택 범위를 정하는 데 사용됩니다.

3. 무작위 번호 선택: 스케줄러는 1부터 총 티켓 수까지의 범위 내에서 무작위로 하나의 번호를 고릅니다.

4. 당첨 프로세스 확인: 선택된 번호가 어떤 프로세스의 추첨권에 해당하는지 확인합니다. 해당 프로세스가 이번 추첨의 '당첨자'가 되어 CPU를 할당받습니다.

5. 주기적 반복: 이러한 추첨 과정을 주기적으로 반복하여 CPU 시간을 지속적으로 분배합니다.

예를 들어 다음과 같은 프로세스들이 있다고 가정해 보겠습니다.

| 프로세스 | 추첨권 수 |
| -------- | --------- |
| A        | 4         |
| B        | 2         |
| C        | 1         |

이 경우 전체 추첨권 수는 4 + 2 + 1 = 7장입니다. 스케줄러는 1부터 7 사이의 숫자 중 하나를 무작위로 선택합니다.

- 1, 2, 3, 4 중 하나가 선택되면 프로세스 A가 CPU를 할당받습니다.
- 5, 6이 선택되면 프로세스 B가 CPU를 할당받습니다.
- 7이 선택되면 프로세스 C가 CPU를 할당받습니다.

이렇게 무작위 선택을 계속 반복하다 보면, 장기적으로는 각 프로세스가 자신의 추첨권 비율만큼 CPU 시간을 할당받게 됩니다. 위 예시에서는 A가 전체의 4/7, B가 2/7, C가 1/7의 CPU 시간을 받게 되는 셈이죠.

추첨 기법의 핵심은 프로세스의 상대적 중요도를 추첨권이라는 간단한 수치로 표현하고, 무작위성을 이용해 이 비율에 맞게 CPU를 분배한다는 것입니다. 이를 통해 사용자나 관리자가 지정한 비율을 최대한 지키면서도 공정한 스케줄링이 가능해집니다.

물론 실제 구현에서는 순수한 무작위 선택보다는 좀 더 효율적인 알고리즘을 사용할 것입니다. 하지만 추첨이라는 기본 아이디어는 비례 배분 스케줄링의 직관적이고 효과적인 해법으로 받아들여지고 있습니다.

## 구현

비례 배분 스케줄링을 실제로 구현하는 대표적인 방법으로 '티켓 기반 추첨(Ticket-Based Lottery)' 알고리즘이 있습니다. 이 알고리즘은 다음과 같은 단계로 동작합니다.

1. 티켓 할당: 각 프로세스의 상대적 중요도에 따라 일정 수의 '티켓(ticket)'을 부여합니다. 중요도가 높을수록 더 많은 티켓을 받게 됩니다.

2. 총 티켓 수 계산: 시스템 내 모든 프로세스가 보유한 티켓의 총합을 계산합니다. 이는 다음 단계에서 추첨 범위를 정하는 데 사용됩니다.

3. 무작위 추첨: 0부터 (총 티켓 수 - 1) 사이의 범위에서 무작위로 한 번호를 선택합니다. 이는 마치 모든 티켓을 모아 놓고 그 중 하나를 뽑는 것과 같습니다.

4. 당첨 프로세스 확인 및 CPU 할당: 추첨에서 선택된 번호가 어떤 프로세스의 티켓에 해당하는지 확인합니다. 해당 프로세스가 이번 추첨의 '당첨자'가 되어 정해진 시간 동안 CPU를 독점적으로 사용할 수 있는 권한을 얻습니다.

5. 주기적 반복: 3번과 4번 단계를 주기적으로 반복하여 CPU 시간을 지속해서 분배합니다. 이렇게 함으로써 장기적으로는 각 프로세스가 자신의 티켓 비율만큼 CPU 시간을 할당받을 수 있게 됩니다.

예를 들어 다음과 같은 프로세스들이 있다고 가정해 보겠습니다.

| 프로세스 | 티켓 수 | CPU 사용 시간 |
| -------- | ------- | ------------- |
| A        | 4       | 200ms         |
| B        | 2       | 100ms         |
| C        | 1       | 50ms          |

이 경우 전체 티켓 수는 4 + 2 + 1 = 7장입니다. 스케줄러는 0부터 6 사이의 숫자 중 하나를 무작위로 선택합니다.

- 0, 1, 2, 3 중 하나가 선택되면 프로세스 A가 200ms 동안 CPU를 독점합니다.
- 4, 5가 선택되면 프로세스 B가 100ms 동안 CPU를 독점합니다.
- 6이 선택되면 프로세스 C가 50ms 동안 CPU를 독점합니다.

이러한 과정을 계속 반복하면, 결과적으로 각 프로세스가 받는 CPU 시간의 비율이 해당 프로세스의 티켓 수 비율과 일치하게 됩니다.

티켓 기반 추첨 알고리즘은 비례 배분 스케줄링의 핵심 아이디어를 충실히 구현한 방식입니다. 프로세스의 중요도를 티켓이라는 간단한 숫자로 표현하고, 이를 기반으로 무작위 추첨을 수행함으로써 각 프로세스에게 공정하게 CPU를 분배할 수 있습니다.

물론 실제 구현에서는 효율성을 위해 순수한 무작위 선택보다는 좀 더 최적화된 알고리즘을 사용할 수 있습니다. 하지만 티켓과 추첨이라는 기본 개념은 비례 배분 스케줄링을 이해하고 구현하는 데 있어 매우 직관적이고 효과적인 도구가 되고 있습니다.

## 장단점

### 장점

- 유연성: 프로세스의 상대적 중요도를 티켓 수로 쉽게 표현할 수 있어, 중요도 변경이 용이합니다.
- 확장성: 새로운 프로세스가 추가되더라도 해당 프로세스에 적절한 수의 티켓을 부여하는 것만으로 간단히 대응할 수 있습니다.
- 장기적 공정성: 비례 배분 스케줄링은 장기적으로 볼 때 각 프로세스에게 티켓 수에 비례하는 공정한 CPU 시간 할당을 보장합니다.

### 단점

- 단기적 불공정성: 무작위 추첨 방식으로 인해 단기적으로는 CPU 시간 할당에 다소 불균형이 생길 수 있습니다.
- 오버헤드: 추첨 과정에서 무작위 번호를 생성하고 당첨 프로세스를 확인하는 데 어느 정도의 연산 비용이 소요됩니다.

## 예제

시스템 내에 A, B, C 세 개의 프로세스가 있고, 각각 다음과 같이 티켓을 할당받았다고 가정해 보겠습니다.

- 프로세스 A: 6장의 티켓
- 프로세스 B: 3장의 티켓
- 프로세스 C: 1장의 티켓

이 경우 전체 티켓 수는 6 + 3 + 1 = 10장입니다. 비례 배분 스케줄링에 따른 CPU 시간 할당 과정은 다음과 같이 진행됩니다.

1. **티켓 할당**: 시스템은 각 프로세스의 중요도에 비례하여 티켓을 분배합니다. 중요도가 높을수록 더 많은 티켓을 받게 되며, 이는 곧 CPU 시간을 받을 확률이 높아짐을 의미합니다.

2. **추첨 과정**: 스케줄러는 전체 티켓 수의 범위 내에서 무작위로 한 번호를 선택합니다. 이번 예시에서는 1부터 10 사이의 숫자 중 하나가 선택되는 셈이죠.

   - 1에서 6 사이의 숫자가 선택되면 프로세스 A가 당첨됩니다.
   - 7에서 9 사이의 숫자가 선택되면 프로세스 B가 당첨됩니다.
   - 10이 선택되면 프로세스 C가 당첨됩니다.

3. **CPU 할당**: 추첨에서 선택된 프로세스는 정해진 시간 동안 CPU를 독점적으로 사용할 수 있게 됩니다. 이러한 추첨 및 할당 과정은 시스템이 원활히 작동할 수 있도록 계속해서 반복됩니다.

이런 식으로 추첨을 반복하다 보면, 결과적으로 각 프로세스는 자신의 티켓 수에 비례하는 CPU 시간을 할당받게 됩니다. 위 예시에서 프로세스 A는 전체 CPU 시간의 약 60%, 프로세스 B는 약 30%, 프로세스 C는 약 10%를 사용하게 될 것입니다.

물론 매번 추첨할 때마다 이 비율이 정확히 맞아떨어지지는 않습니다. 하지만 추첨을 충분히 많이 반복하면 평균적으로는 각 프로세스가 받는 CPU 시간이 티켓 수에 비례하게 되는 거죠. 이것이 바로 비례 배분 스케줄링이 장기적 공정성을 보장하는 이유입니다.

## 요약

비례 배분 스케줄링은 시스템 내의 여러 프로세스나 작업들 사이에서 CPU 시간을 공정하게 나누어주는 방식 중 하나입니다. 이 방식에서는 각 프로세스의 상대적 중요도에 따라 일정 수의 '추첨권(ticket)'을 부여하는데, 이는 마치 추첨에 응모하는 것과 비슷합니다. 추첨권의 수가 많을수록 해당 프로세스가 CPU 시간을 얻을 확률이 높아지는 거죠.

스케줄러는 각 프로세스가 가진 추첨권의 수에 비례하여 CPU 시간을 할당합니다. 즉, 추첨권을 많이 가진 프로세스일수록 더 자주, 더 오랫동안 CPU를 사용할 수 있게 되는 것입니다. 이를 통해 프로세스의 상대적 중요도를 CPU 시간 할당에 공정하게 반영할 수 있습니다.

비례 배분 스케줄링의 주요 특징은 다음과 같습니다:

- 상대적 중요도의 반영: 각 프로세스에 할당된 추첨권의 수는 그 프로세스의 중요도를 나타냅니다. CPU 시간은 이 추첨권 수에 비례하여 분배되므로, 중요도가 높은 프로세스는 자연스럽게 더 많은 CPU 시간을 받게 됩니다.

- 유연한 우선순위 조정: 프로세스의 중요도는 추첨권 수를 조정하는 것만으로 쉽게 변경할 수 있습니다. 새로운 프로세스가 추가되거나 기존 프로세스의 우선순위를 바꿔야 할 때 매우 유용합니다.

- 장기적 공정성 보장: 충분히 긴 시간 동안 스케줄링을 수행하면, 각 프로세스는 자신의 추첨권 비율만큼의 CPU 시간을 받게 됩니다. 이는 시스템 자원이 프로세스 간에 공정하게 분배됨을 의미합니다.

하지만 비례 배분 스케줄링에도 몇 가지 단점이 있습니다. 우선 무작위 추첨 방식 때문에 단기적으로는 CPU 할당이 불균형해 보일 수 있습니다. 또한 추첨을 수행하고 당첨 프로세스를 확인하는 과정에서 어느 정도의 오버헤드가 발생할 수 있습니다.

그럼에도 불구하고 비례 배분 스케줄링은 프로세스의 상대적 중요도를 유연하게 반영하면서 시스템 자원을 효율적이고 공정하게 관리할 수 있는 강력한 방법입니다. 시스템의 요구사항과 우선순위가 다양한 환경에서 적응력을 발휘할 수 있기에, 여러 분야에서 폭넓게 활용되고 있습니다.

운영체제의 CPU 스케줄링 알고리즘으로서뿐만 아니라, 네트워크 대역폭 할당, 디스크 I/O 스케줄링 등 컴퓨터 시스템의 다양한 자원 관리 문제에 비례 배분 스케줄링의 아이디어를 적용할 수 있습니다. 그만큼 개념이 직관적이고 구현이 간단하면서도 효과적이라고 할 수 있겠죠.
